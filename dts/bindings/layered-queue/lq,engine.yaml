# Copyright (c) 2026 Layered Queue Driver
# SPDX-License-Identifier: Apache-2.0

description: |
  Layered Queue Engine - root node for complete system configuration
  
  This binding defines the top-level engine structure that contains:
  - Hardware input sources (ISR-safe ringbuffers)
  - Mid-level processing drivers (merges, validators)
  - Output event generators (cyclic, on-change)
  - Signal storage and state
  
  The engine coordinates all 5 phases:
  1. Ingest: Pull samples from hardware inputs
  2. Staleness: Mark old inputs as stale
  3. Merges: Voter/validator processing
  4. Outputs: Generate on-change events
  5. Cyclic: Generate deadline-based periodic outputs

compatible: "lq,engine"

child-binding:
  description: |
    Child nodes define the components of the engine.
    Use labels to reference nodes in other sections.

properties:
  cycle-time-hz:
    type: int
    default: 100
    description: |
      Engine processing cycle frequency in Hz.
      Overrides CONFIG_LQ_ENGINE_CYCLE_TIME_US if specified.

      Common values:
        10 Hz (100ms): Slow, low-priority monitoring
        50 Hz (20ms): Medium-speed control loops
        100 Hz (10ms): Fast control and monitoring (recommended)
        1000 Hz (1ms): High-speed control loops
        10000 Hz (100us): Very high-speed (motor commutation, power electronics)

      Note: Must be compatible with RTOS tick rate and realistic for CPU load.

  cycle-time-us:
    type: int
    description: |
      Alternative: Engine cycle time in microseconds.
      If both cycle-time-hz and cycle-time-us are specified,
      cycle-time-us takes precedence.

      Example: 10000 = 10ms = 100Hz

  max-signals:
    type: int
    default: 32
    description: Maximum number of internal signals (overrides Kconfig)

  max-merges:
    type: int
    default: 8
    description: Maximum number of merge/validator contexts

  max-cyclic-outputs:
    type: int
    default: 16
    description: Maximum number of cyclic output contexts

  max-output-events:
    type: int
    default: 64
    description: Maximum size of output event queue

  init-priority:
    type: int
    default: 85
    description: |
      Device initialization priority for the engine subsystem.
      Must be after all sensor/input devices are initialized.

      Typical priority order:
        50-59: I2C/SPI/CAN bus drivers
        60-69: Sensor drivers (TMP117, BME280, etc.)
        70-79: Application-specific drivers
        80-84: Hardware input layer
        85-89: Engine and processing layer
        90+:   Application tasks
