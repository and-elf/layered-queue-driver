# Copyright (c) 2026 Layered Queue Driver
# SPDX-License-Identifier: Apache-2.0

description: |
  Mid-Level Merge Driver - Multi-input voter with redundancy
  
  Combines multiple input signals using a voting algorithm.
  Processes during engine phase 3 (merges).
  
  Voting methods:
  - median: Use median value (default, best for 3+ sensors)
  - average: Average all inputs (smooth but sensitive to outliers)
  - min: Minimum value (conservative)
  - max: Maximum value (aggressive)

compatible: "lq,mid-merge"

properties:
  sources:
    type: phandles
    description: |
      (v2.0 - PREFERRED) Array of source node phandles to merge.
      Example: sources = <&sensor_a &sensor_b &sensor_c>;
      Must have at least 2 sources for voting to work.

  output-signal-id:
    type: int
    required: false
    description: |
      (v1.x - DEPRECATED) Signal ID where merge result is stored.
      In v2.0, output IDs are auto-assigned.

  input-signal-ids:
    type: array
    required: false
    description: |
      (v1.x - DEPRECATED) Array of input signal IDs to merge.
      Use 'sources' phandle array instead for v2.0.
      All inputs must be valid for merge to succeed.

  voting-method:
    type: string
    default: "median"
    enum: ["median", "average", "min", "max"]
    description: Algorithm used to combine input values

  tolerance:
    type: int
    default: 0
    description: |
      Maximum allowed spread between inputs (after voting).
      If spread > tolerance, status becomes LQ_EVENT_INCONSISTENT.
      Set to 0 to disable tolerance checking.

  stale-us:
    type: int
    default: 0
    description: |
      Staleness timeout for the merged signal.
      If 0, inherits from input staleness.
